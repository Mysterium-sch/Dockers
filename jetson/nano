FROM nvidia/cuda:12.3.1-base-ubuntu20.04

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Etc/UTC
ENV LANG=C.UTF-8 LC_ALL=C.UTF-8
ENV ROS_DISTRO=noetic

RUN apt-get update && apt-get install -y --no-install-recommends gnupg2 dirmngr && \
    apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654 && \
    sh -c 'echo "deb http://packages.ros.org/ros/ubuntu focal main" > /etc/apt/sources.list.d/ros-latest.list'

RUN apt-get update && apt-get install -y --no-install-recommends \
    cmake \
    zip \
    unzip \
    git \
    tmux \
    wget \
    curl \
    vim \
    build-essential \
    python3-rosdep python3-rosinstall python3-rosinstall-generator python3-wstool build-essential \
	python3-catkin-tools python3-osrf-pycommon \
    ros-$ROS_DISTRO-desktop-full && \
    rm -rf /var/lib/apt/lists/*

RUN echo '#!/bin/bash\nset -e\nsource "/opt/ros/noetic/setup.bash"\nexec "$@"' > /ros_entrypoint.sh && \
    chmod +x /ros_entrypoint.sh

RUN apt-get update && apt-get install -y \
    ros-noetic-catkin \
	ros-noetic-tf2-sensor-msgs \
    ros-noetic-camera-info-manager \
    ros-noetic-diagnostic-updater \
    ros-noetic-dynamic-reconfigure \
    ros-noetic-image-exposure-msgs \
    ros-noetic-image-transport \
    ros-noetic-nodelet \
    ros-noetic-sensor-msgs \
    ros-noetic-wfov-camera-msgs \
    ros-noetic-roscpp

RUN rosdep init &&\
    rosdep update

ENV WORKSPACE /catkin_ws

RUN mkdir -p $WORKSPACE/src && \
	mkdir -p $WORKSPACE/build

RUN  cd $WORKSPACE/src &&\
	git clone https://github.com/Mysterium-sch/flir_camera_driver.git &&\
    cd flir_camera_driver &&\ 
	git checkout noetic

RUN cd $WORKSPACE && \
	catkin init && \
	catkin config --extend /opt/ros/noetic && \
	catkin config --cmake-args -DCMAKE_BUILD_TYPE=Release

RUN	cd $WORKSPACE &&\
	catkin build -j$(nproc)

ENTRYPOINT cd $WORKSPACE &&\
	/bin/bash

